\chapter{Introduction}  % Motivation
\label{chap:intro}

\begin{chapquote}{Friedrich Hayek}
“We can’t take it [money] violently out of the hands of government. All we can do is by some sly, roundabout way introduce something they can’t stop.”
\end{chapquote}
\begin{chapquote}{Anonymous}
  You will not find a solution to political problems in cryptography.
\end{chapquote}
\begin{chapquote}{Satoshi Nakamoto}
  [Repling to the above] Yes, but we can win a major battle in the arms race and gain a new territory of freedom for several years.
\end{chapquote}

\vskip 1em

\section{Bitcoin is Money}
Settling value between diverse parties is an age old problem that has seen many solutions over the years. Over time, settling value also subsumed the related problem of storing value across time. It also subsumed the other related problem of broadcasting the perceived value of something to others. These three can be concisely written as:
\begin{itemize}
    \item Medium of exchange.
    \item Store of value.
    \item Unit of account.
\end{itemize}
The solution to these problems is often called ``Money''. For money to work, one instance of money cannot be used to pay twice. This is the famous \textit{double spending} problem. Money cannot work if it can be created out of nothing. We will call this the \textit{monetary policy} problem. Money cannot work if someone can prevent the settling of value of between others. This is the \textit{censorship resistance} problem. Historically, governments have created their own monies and as such, have complete control over how money works in their jurisdiction. They use the threat of punishment to solve the double spending problem. They assure their citizens that their monetary policy is backed by the full faith and credit of their government. Government monetary policy also exclude other monies from working inside their jurisdiction. They also assure their citizens that they will not censor transactions. These are political promises, and are often broken.

Bitcoin is money that is not issued or controlled by any government. It solves the problems of double spending, monetary policy, and censorship-resistance using a combination of cryptography, distributed systems engineering, and the somewhat complicated notion that people want such a system and are willing to run software that enforces the rules of Bitcoin. Users loosely agree on the following social contract: we will run compatible software to enforce the universal rules of Bitcoin. This is a bootstrapped social contract from January 2009, and in our research into Bitcoin, we assume that this social contract works. We also assume the axiom of resistance\cite{axiom_of_resistance}, which states that it is possible for a system to resist state control. These assumptions are crucial in understanding why Bitcoin could work as a money, and in our opinion, these assumptions cannot really be proven -- only time will tell.

This dissertation will instead focus on other problems in the Bitcoin ecosystem like censorship resistance, privacy, scalability, and the advantages of Bitcoin's conservative design from a technical perspective.

\section{Censorship Resistance}
In the world of traditional money, cash transactions are hard to censor. Governments censor cash transactions by placing barriers to cash transactions irrespective of their legality. Such barriers commonly include limits on value of cash transactions, demonetization of entire sets of cash bills, limits on how much cash any individual can hold, etc. These large nets are not precise and tend to catch innocent transactions as well.

Digital transactions, on the other hand, can be censored precisely. Governments send censorship ``orders'' to regulated financial intermediaries like banks, clearing houses, and payment gateways. These intermediaries reconfigure their software to implement the censorship. Censorship orders are either specific to certain users or certain types of transactions. Users are tied to their financial intermediary and the cost of switching intermediaries is prohibitively expensive, if not impossible. For example, a user can switch their bank account to a more favorable bank. But if the user is censored at the government controlled payments gateway, switching gateways is not an option -- as there is typically only one such gateway. With their legal control over intermediaries, governments can censor transactions done with traditional money.

Bitcoin transactions are broadcast into the peer to peer network by users, and are eventually confirmed by being included in a block by some miner. The peer to peer network of users and miners are spread across the world in many jurisdictions. A transaction can offer a specific fee denominated in bitcoin, the currency. This fee (or lack thereof) is the main incentive that miners have to include a transaction in the next block they are mining. If the fee is low, the transaction gets ignored by miners. If the fee is high, the transaction is included in their next block by some miner. Governments have no easy way to affect this peer to peer network from broadcasting and confirming transactions.

Even if some miner decides to censor some transactions, the transaction itself is globally censored only if 50\% all the mining hashpower decides to censor it. Bitcoin's double-spending protection also works only if 50\% of the all the mining hashpower decide to not go along with a double-spending attack. The requirement that more than 50\% of the mining hashpower is not colluding together to accomplish a specific objective is essential to Bitcoin's functioning. Crucially, unlike in traditional finance, the user is not tied to their intermediary -- in this case, any single miner. Any miner willing to pick up a transaction is enough for it to get confirmed eventually - given that more than 50\% of the mining hashpower is ambivalent about this transaction.

In Chapter \ref{chapter:bribing}, we ask whether miners can be financially motivated to censor transactions. There is a type of Bitcoin smart contract called Hashed Timelock Contract (HTLC) which binds two parties into spending some bitcoin in a specific way. A HTLC is justly enforced when only one of the parties is able to get a followup transaction confirmed. If both parties try to get their own followup transactions confirmed, we have a race condition where one party is incentivized to censor the other by outbidding them on fees. The HTLC smart contract\footnote{HTLC's are more formally defined in the background section of Chapter \ref{chap:background}.} solves this by timelocking one of the spending arms of the contract and hashlocking the other arm. If the hashlock arm opens up, it is valid immediately as per Bitcoin's consenus rules. The timelocked arm becomes valid when the timelock expires. 

We ask if the timelocked arm can bribe miners to censor a valid hashlocked arm till the timelock runs out. Our result indicates that the hashlocked arm can offer slightly more fees (as a percentage of the bribe) than the percentage of hashpower controlled by the weakest known miner, and can avoid censorship. We also derive the length of the timelock $T$ that goes along with the ratio of the hashlock arm fees $f$ and the bribe value $b$.

\section{Privacy}
Bitcoin's entire set of transactions from genesis to now is publicly available in the form of its blockchain database. In fact, this set of all transactions is used to build the current state of the world that is used to verify whether a new transaction is valid or not. Storing the entire blockchain in public makes it easy for anyone to analyze transactions to glean information on who is doing what. With effort, some Bitcoin identities can be mapped to real world identities. Combined with additional heuristics, entire series of transactions can be mapped to real world interactions.

% \subsection{Coinjoins}
% To thwart this, the Bitcoin ecosystem has evolved certain privacy practices that hinder chain analysis. A coinjoin is a special type of transaction where many parties come together to create a multi-input transaction, and on the other side take out equivalent value as output. Such a transaction can obfuscate the trail of ownership of bitcoin as every party has plausible deniability about where their bitcoin came from. One major privacy hole in coinjoins is the way in which they are orchestrated. To construct the coinjoin transaction, a central party has to setup the inputs and outputs such that no user is cheating any other user. Coinjoin protocols ensure that the central coordinator cannot map inputs to outputs, thereby preserving privacy. 

% The one outstanding problem with coinjoins is that the identity of the central coordinator has to be well known. This makes them an easy target to be taken down. In Chapter \ref{chap:coinjoins}, we look at a decentralized protocol that helps users come together to perform a coinjoin. The protocol is built on top of the Lightning Network (explained more in detail in the Background section in Chapter \ref{chap:background}), and makes every Lightning node a potential coinjoin coordinator. 

One way of thwarting chain analysis is for two parties to just swap their coins for no commercial reason. Such a swap breaks the chain of ownership of a specific coin. Atomic Swaps enable users to to perform such swaps trustlessly with just peer to peer communication.

Classic Atomic Swap protocols lock both users coins for a time period during the swap execution. This allows one of the parties to possibly ``grief'' the other party. Griefing in this context is to make the other party lose the time value of their money. The guilty party accomplishes griefing by not going through with the swap to completion, but by bailing out during some intermediate step. The existence of such griefing attacks reduces the adoption of atomic swaps and thereby hurts the ecosystem's privacy.

In Chapter \ref{chapter:swaps}, we propose a modification to the classic Atomic Swap protocol. Our Grief-free Atomic Swap protocol compensates the griefing victim with a premium taken from the offending party. Previous research into this problem had relied on more powerful smart contract primitives to construct grief-free atomic swaps. Our construction is simpler, and relies only on Bitcoin's existing primitives - without needing additional operators to be added to Bitcoin's limited language. This is an important distinction because adding new primitives to Bitcoin is getting increasingly harder as Bitcoin moves towards ossification. 

\section{Scalability}
With a cap of 1MB on the size of each block, Bitcoin inherently limits the number of transactions that can fit into a block. The average size of a transaction is 300 bytes; with a block about every 10 minutes, the throughput is bounded to about 6 transactions per second. If we are to imagine a world where Bitcoin is used to pay for coffee, Bitcoin has to settle far more transactions than it does now. For context, Visa processes 7000 transactions per second. 

The Lightning Network is a second layer network on top of Bitcoin where orders of magnitude more transactions can happen. It is a network of channels where a channel connects two nodes which run an instance of the Lightning software. These two nodes share a Bitcoin transaction whose value they alternate back and forth (like the beads on an abacus rod) using cryptographic signatures, among other things. This value-reallocation between two nodes at the ends of a channel can be used to implement payments between nodes that are connected in a graph of channels. As every payment is not settled on the Bitcoin blockchain, we get scale. 

There is a catch though. In Bitcoin, the recipient of value can be offline and still be assured that the value settlement will happen. In Lightning, an offline node can be cheated by its channel counterparty. Channel operators could employ a paid service, called a watchtower, to be online on their behalf and monitor against cheating counterparties. The current design of Lightning channels makes these watchtowers store orders of magnitude more data than what is ideally required. In Chapter \ref{chapter:outpost}, we propose a new channel design that considerably reduces the storage requirements of these watchtowers. 

\section{Conservative Design}
Unlike other blockchain platforms like Ethereum, Bitcoin does not support stateful smart contracts. In a stateful smart contract, anyone can interact with the state of the smart contract to perform allowed operations. An example would be a lending smart contract, where anyone can contribute to a pool of capital that others can borrow from. To ensure that the borrower repays the loan, the contract forces the borrower to put up another asset as a collateral whose value is more than the borrowed asset. The smart contract's immutable code controls the mechanism of deposits, borrowing, repayment, and collateralization. Bitcoin does not support such smart contracts as it has no mechanism to implement stateful systems where anyone can interact with the state of a contract on a continuous basis. Bitcoin's existing state system creates and destroys local state on a per-transaction basis. There is no automatic way to carry over previous state to the next transaction. It can be argued that the lack of such powerful state transitions makes Bitcoin smart contracts rather weak, and not powerful enough to build true decentralized financial applications like lending, market-making, synthetic asset creation, and so forth - collectively called DeFi.

On the other hand, such DeFi contracts on platforms like Ethereum are only useful if they deal with real world assets like traditional currencies, stocks, bonds, and so forth. To integrate the world of DeFi with traditional assets, we need oracles who can feed data about these assets into the smart contracts that make up DeFi. We argue that these Oracles can be manipulated so that DeFi smart contracts get the wrong impression about the real world. This manipulation leads to DeFi users suffering ``unfair'' losses. 

Traditionally, centralized third parties were used to ingest real world data into smart contracts. To mitigate against the obvious corruptibility of such centralized oracles, some DeFi contracts use the state data of on-chain automated market-makers to derive the real world price of assets. This opens up the attack vector of manipulating the market-maker's price of an asset to profit from the dependent smart contract. In Chapter \ref{chapter:oracles}, we show that such market-maker based price feeds can be manipulated at a cheaper cost than originally thought. 

Bitcoin's design can be modified to carry over state from one transaction to another through ``covenants''. Covenant proposals have not been adopted in Bitcoin so far in part because of risks that covenant enabled smart contracts pose to Bitcoin users. Our analysis of such attacks on DeFi contracts on Ethereum hints that Bitcoin's prudent approach to avoiding the entire space of such designs might be better its for users in the long run.

\section{Why Bitcoin Matters}
The nature of government controlled money changes so often that other hard assets sometimes take over the function of money. This distorts the prices of these assets. Bitcoin moves the control of money from specific individuals to a nebulous network of users. Consequently, changing what money means, or how it works, gets harder as this group of users grows larger, more diverse, and spread across different ideologies and jurisdictions. When money becomes hard to change, prices start to reflect reality. As prices reflect reality, they start to positively influence society's ability to coordinate and advance.

In his seminal essay ``The Use of Knowledge in Society'' \cite{Hayek_AER45}, Hayek argues that prices reflecting reality is the key to making soecities work:
\begin{displayquote}
Fundamentally, in a system in which the knowledge of the relevant facts is dispersed among many people, prices can act to coordinate the separate actions of different people in the same way as subjective values help the individual to coordinate the parts of his plan.
\end{displayquote}

Bitcoin's inflexible nature will hopefully always keep prices reflecting reality. But it's not been easy so far. It is well known that Bitcoin's purchasing power is volatile. It was zero when Bitcoin was created. During its growing period, it has been through violent ups and downs. It can be argued that a money whose purchasing power is volatile is not a good money. We believe that we are still in a phase where only the neediest transactions are using Bitcoin for its censorship resistance despite its volatile purchasing power. Over time, as these transactions grow in volume, Bitcoin's other property of being a non-state, fixed money will only become more well known. Hopefully, in our lifetime, we will see Bitcoin being used to such an extent that no matter how goods are priced, market prices reflect market reality.

Over the last few decades, advances in technology should have been a deflationary force. But it turns out that we have mostly lived through an inflationary period, despite advancing technology. We, like Milton Friedman, argue that the increasing supply of money is the root cause for such inflation. Bitcoin's promise of being a fixed-supply money is the hope we have that the the deflationary forces of technology will make our lives much better than what it is today.